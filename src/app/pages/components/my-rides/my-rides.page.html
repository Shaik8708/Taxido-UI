<!-- header starts -->
<app-header></app-header>
<!-- header end -->

<ion-content style="--background: #f8f9fa">
  <!-- my ride section starts -->
  <section class="section-b-space">
    <ul
      class="nav nav-pills my-ride-tab w-100 border-0 m-0"
      id="Tab"
      role="tablist"
    >
      <li class="nav-item" role="presentation">
        <button
          class="nav-link active"
          id="pill-pending-tab"
          data-bs-toggle="pill"
          data-bs-target="#pending-tab"
          (click)="getFilteredRides('accepted')"
        >
          Pending Ride
        </button>
      </li>

      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="pill-complete-tab"
          data-bs-toggle="pill"
          data-bs-target="#complete-tab"
          (click)="getFilteredRides('completed')"
        >
          Complete Ride
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button
          class="nav-link"
          id="pill-cancel-tab"
          data-bs-toggle="pill"
          data-bs-target="#cancel-tab"
          (click)="getFilteredRides('cancelled')"
        >
          Cancel Ride
        </button>
      </li>
    </ul>

    <div class="custom-container">
      <div class="tab-content ride-content" id="TabContent">
        <div class="tab-pane fade active show" id="pending-tab">
          <ul class="my-ride-list driver-ride-list">
            <!-- Loading state -->
            <li *ngIf="isLoading" class="text-center p-3">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </li>

            <!-- No results -->
            <li
              *ngIf="!isLoading && filteredRides.length === 0"
              class="text-center p-3"
            >
              <p class="content-color">No rides found.</p>
            </li>

            <!-- Data bound rides (mapped to API payload fields) -->
            <li *ngFor="let ride of filteredRides" class="white-background">
              <div class="my-ride-box">
                <div class="my-ride-head">
                  <a
                    [routerLink]="['/pending-ride-details']"
                    [queryParams]="{ id: ride?._id || ride?.id }"
                    class="my-ride-img"
                  >
                    <img
                      class="img-fluid profile-img"
                      [src]="ride?.userId?.avatar || ride?.profileImage || '../../assets/images/profile/p5.png'"
                      alt="profile"
                    />
                  </a>

                  <div class="my-ride-content flex-column">
                    <div class="flex-spacing">
                      <a
                        [routerLink]="['/pending-ride-details']"
                        [queryParams]="{ id: ride?._id || ride?.id }"
                      >
                        <h6 class="title-color fw-medium">
                          {{ ride?.userId?.username || ride?.userName ||
                          'Unknown' }}
                        </h6>
                      </a>
                      <h5 class="fw-mediun success-color">
                        {{ (ride?.totalAmount != null) ? ('₹ ' +
                        ride.totalAmount) : '-' }}
                      </h5>
                    </div>
                    <div class="flex-align-center gap-3">
                      <!-- <div class="flex-align-center gap-1">
                        <img
                          class="star"
                          src="../../assets/images/svg/star.svg"
                          alt="star"
                        />
                        <h5 class="fw-normal title-color">
                          {{ ride?.rating || '—' }}
                        </h5>
                        <span class="content-color fw-normal"
                          >({{ ride?.ratingCount || 0 }})</span
                        >
                      </div> -->
                      <div class="flex-align-center gap-1">
                        <i class="iconsax icon" data-icon="route-1"> </i>
                        <h6 class="fw-normal title-color">
                          {{ (ride?.totalKm != null) ? (ride.totalKm + ' km') :
                          '-' }}
                        </h6>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="my-ride-details">
                  <div class="ride-info">
                    <h6 class="fw-normal title-color">
                      {{ ride.pickUpDate | date:'dd MMM yyyy' }} at {{
                      ride.pickUpTime | date:'hh:mm a' }}
                    </h6>
                    <div class="flex-align-center gap-2">
                      <a href="chatting.html">
                        <img
                          class="img-fluid communication-icon"
                          src="../../assets/images/svg/messages-fill.svg"
                          alt="messages"
                        />
                      </a>
                      <a [href]="'tel:' + (ride?.userId?.phoneNumber || '')">
                        <img
                          class="img-fluid communication-icon"
                          src="../../assets/images/svg/call-fill.svg"
                          alt="call"
                        />
                      </a>
                    </div>
                  </div>
                  <ul class="ride-location-listing">
                    <li
                      *ngFor="let location of ride?.locations; let i = index"
                      class="border-0 shadow-none"
                    >
                      <div class="location-box">
                        <img
                          class="icon"
                          [src]="i === 0 ? '../../assets/images/svg/location-fill.svg' : (i === ride.locations.length - 1 ? '../../assets/images/svg/gps.svg' : '../../assets/images/svg/location-fill.svg')"
                          [alt]="i === 0 ? 'pickup' : (i === ride.locations.length - 1 ? 'dropoff' : 'waypoint')"
                        />
                        <h5
                          class="fw-light title-color"
                          [class.border-0]="i === ride.locations.length - 1"
                        >
                          {{ location?.address || location || '-' }}
                        </h5>
                      </div>
                    </li>
                  </ul>
                  <!-- <ul class="ride-location-listing">
                    <li class="border-0 shadow-none">
                      <div class="location-box">
                        <img
                          class="icon"
                          src="../../assets/images/svg/location-fill.svg"
                          alt="location"
                        />
                        <h5 class="fw-light title-color">
                          {{ (ride?.locations && ride.locations.length) ?
                          (ride.locations[0]?.address || ride.locations[0]) :
                          '-' }}
                        </h5>
                      </div>
                    </li>

                    <li class="border-0 shadow-none">
                      <div class="location-box">
                        <img
                          class="icon"
                          src="../../assets/images/svg/gps.svg"
                          alt="gps"
                        />
                        <h5 class="fw-light title-color border-0">
                          {{ (ride?.locations && ride.locations.length) ?
                          (ride.locations[ride.locations.length - 1]?.address ||
                          ride.locations[ride.locations.length - 1]) : '-' }}
                        </h5>
                      </div>
                    </li>
                  </ul> -->
                </div>
                <a
                  [routerLink]="['/pending-ride-details']"
                  [queryParams]="{ id: ride?._id || ride?.id }"
                  class="btn theme-btn w-100 mt-3"
                  >Start Ride</a
                >
                <a
                  [routerLink]="['/pending-ride-details']"
                  [queryParams]="{ id: ride?._id || ride?.id }"
                  class="btn theme-btn w-100 mt-3"
                  >Pickup Customer</a
                >
              </div>
            </li>
          </ul>
        </div>

        <div class="tab-pane fade" id="complete-tab">
          <ul class="my-ride-list driver-ride-list">
            <!-- Loading state -->
            <li *ngIf="isLoading" class="text-center p-3">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </li>

            <!-- No results -->
            <li
              *ngIf="!isLoading && filteredRides.length === 0"
              class="text-center p-3"
            >
              <p class="content-color">No rides found.</p>
            </li>

            <!-- Data bound rides (Complete) -->
            <li *ngFor="let ride of filteredRides" class="white-background">
              <div class="my-ride-box">
                <div class="my-ride-head">
                  <a
                    [routerLink]="['/complete-ride-details']"
                    [queryParams]="{ id: ride?._id || ride?.id }"
                    class="my-ride-img"
                  >
                    <img
                      class="img-fluid profile-img"
                      [src]="ride?.userId?.avatar || ride?.profileImage || '../../assets/images/profile/p5.png'"
                      alt="profile"
                    />
                  </a>

                  <div class="my-ride-content flex-column">
                    <div class="flex-spacing">
                      <a
                        [routerLink]="['/complete-ride-details']"
                        [queryParams]="{ id: ride?._id || ride?.id }"
                      >
                        <h6 class="title-color fw-medium">
                          {{ ride?.userId?.username || ride?.userName ||
                          'Unknown' }}
                        </h6>
                      </a>
                      <h5 class="fw-mediun success-color">
                        {{ (ride?.totalAmount != null) ? ('₹ ' +
                        ride.totalAmount) : '-' }}
                      </h5>
                    </div>
                    <div class="flex-align-center gap-3">
                      <!-- <div class="flex-align-center gap-1">
                        <img
                          class="star"
                          src="../../assets/images/svg/star.svg"
                          alt="star"
                        />
                        <h5 class="fw-normal title-color">
                          {{ ride?.rating || '—' }}
                        </h5>
                        <span class="content-color fw-normal"
                          >({{ ride?.ratingCount || 0 }})</span
                        >
                      </div> -->
                      <!-- <div class="flex-align-center gap-1">
                        <i class="iconsax icon" data-icon="route-1"> </i>
                        <h6 class="fw-normal title-color">
                          {{ (ride?.totalKm != null) ? (ride.totalKm + ' km') :
                          '-' }}
                        </h6>
                      </div> -->
                    </div>
                  </div>
                </div>

                <div class="my-ride-details">
                  <div class="ride-info">
                    <h6 class="fw-normal title-color">
                      {{ ride.pickUpDate | date:'dd MMM yyyy' }} at {{
                      ride.pickUpTime | date:'hh:mm a' }}
                    </h6>
                    <div class="flex-align-center gap-1">
                      <i class="iconsax icon" data-icon="route-1"> </i>
                      <h6 class="fw-normal title-color">
                        {{ (ride?.totalKm != null) ? (ride.totalKm + ' km') :
                        '-' }}
                      </h6>
                    </div>
                  </div>
                  <ul class="ride-location-listing">
                    <li
                      *ngFor="let location of ride?.locations; let i = index"
                      class="border-0 shadow-none"
                    >
                      <div class="location-box">
                        <img
                          class="icon"
                          [src]="i === 0 ? '../../assets/images/svg/location-fill.svg' : (i === ride.locations.length - 1 ? '../../assets/images/svg/gps.svg' : '../../assets/images/svg/location-fill.svg')"
                          [alt]="i === 0 ? 'pickup' : (i === ride.locations.length - 1 ? 'dropoff' : 'waypoint')"
                        />
                        <h5
                          class="fw-light title-color"
                          [class.border-0]="i === ride.locations.length - 1"
                        >
                          {{ location?.address || location || '-' }}
                        </h5>
                      </div>
                    </li>
                  </ul>
                </div>
                <a
                  [routerLink]="['/complete-ride-details']"
                  [queryParams]="{ id: ride?._id || ride?.id }"
                  class="btn theme-btn w-100 mt-3"
                  >View Ride</a
                >
              </div>
            </li>
          </ul>
        </div>

        <div class="tab-pane fade" id="cancel-tab">
          <ul class="my-ride-list driver-ride-list">
            <!-- Loading state -->
            <li *ngIf="isLoading" class="text-center p-3">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </li>

            <!-- No results -->
            <li
              *ngIf="!isLoading && filteredRides.length === 0"
              class="text-center p-3"
            >
              <p class="content-color">No rides found.</p>
            </li>

            <!-- Data bound rides (Cancelled) -->
            <li *ngFor="let ride of filteredRides" class="white-background">
              <div class="my-ride-box">
                <div class="my-ride-head">
                  <a
                    [routerLink]="['/cancel-ride-details']"
                    [queryParams]="{ id: ride?._id || ride?.id }"
                    class="my-ride-img"
                  >
                    <img
                      class="img-fluid profile-img"
                      [src]="ride?.userId?.avatar || ride?.profileImage || '../../assets/images/profile/p5.png'"
                      alt="profile"
                    />
                  </a>

                  <div class="my-ride-content flex-column">
                    <div class="flex-spacing">
                      <a
                        [routerLink]="['/cancel-ride-details']"
                        [queryParams]="{ id: ride?._id || ride?.id }"
                      >
                        <h6 class="title-color fw-medium">
                          {{ ride?.userId?.username || ride?.userName ||
                          'Unknown' }}
                        </h6>
                      </a>
                      <h5 class="fw-mediun success-color">
                        {{ (ride?.totalAmount != null) ? ('₹ ' +
                        ride.totalAmount) : '-' }}
                      </h5>
                    </div>
                    <div class="flex-align-center gap-3">
                      <!-- <div class="flex-align-center gap-1">
                        <img
                          class="star"
                          src="../../assets/images/svg/star.svg"
                          alt="star"
                        />
                        <h5 class="fw-normal title-color">
                          {{ ride?.rating || '—' }}
                        </h5>
                        <span class="content-color fw-normal"
                          >({{ ride?.ratingCount || 0 }})</span
                        >
                      </div> -->
                    </div>
                  </div>
                </div>

                <div class="my-ride-details">
                  <div class="ride-info">
                    <h6 class="fw-normal title-color">
                      {{ ride.pickUpDate | date:'dd MMM yyyy' }} at {{
                      ride.pickUpTime | date:'hh:mm a' }}
                    </h6>
                    <div class="flex-align-center gap-1">
                      <i class="iconsax icon" data-icon="route-1"> </i>
                      <h6 class="fw-normal title-color">
                        {{ (ride?.totalKm != null) ? (ride.totalKm + ' km') :
                        '-' }}
                      </h6>
                    </div>
                  </div>
                  <ul class="ride-location-listing">
                    <li
                      *ngFor="let location of ride?.locations; let i = index"
                      class="border-0 shadow-none"
                    >
                      <div class="location-box">
                        <img
                          class="icon"
                          [src]="i === 0 ? '../../assets/images/svg/location-fill.svg' : (i === ride.locations.length - 1 ? '../../assets/images/svg/gps.svg' : '../../assets/images/svg/location-fill.svg')"
                          [alt]="i === 0 ? 'pickup' : (i === ride.locations.length - 1 ? 'dropoff' : 'waypoint')"
                        />
                        <h5
                          class="fw-light title-color"
                          [class.border-0]="i === ride.locations.length - 1"
                        >
                          {{ location?.address || location || '-' }}
                        </h5>
                      </div>
                    </li>
                  </ul>
                </div>
                <a class="btn theme-btn w-100 mt-3">View Ride</a>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>
  <!-- my ride section end -->

  <!-- panel-space start -->
  <section class="panel-space"></section>
  <!-- panel-space end -->
</ion-content>

<!-- bottom navbar start -->
<app-tabs></app-tabs>
<!-- bottom navbar end -->

<!-- sidebar starts -->
<app-side-bar></app-side-bar>
<!-- sidebar end -->
