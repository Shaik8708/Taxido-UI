<!-- header starts -->
<app-header></app-header>
<!-- header end -->

<ion-content style="--background: #f8f9fa">
  <!-- active ride starts -->
  <section>
    <div class="custom-container">
      <ul class="my-ride-list driver-ride-list mt-0">
        <li *ngIf="isLoading">
          <div class="text-center py-4">
            <ion-spinner></ion-spinner>
          </div>
        </li>

        <li *ngIf="!isLoading && hasError">
          <div class="alert alert-danger">{{ errorMessage }}</div>
        </li>

        <li *ngIf="!isLoading && !hasError && rides.length === 0">
          <div class="no-data text-center py-4">No active rides found.</div>
        </li>

        <li *ngFor="let ride of rides">
          <div class="my-ride-box">
            <div class="my-ride-head">
              <a
                [routerLink]="['/active-ride-details']"
                [queryParams]="{ id: ride?._id || ride?.id }"
                class="my-ride-img"
              >
                <img
                  class="img-fluid profile-img"
                  [src]="ride?.userId?.avatar || '../../assets/images/profile/p5.png'"
                  alt="p5"
                />
              </a>

              <div class="my-ride-content flex-column">
                <div class="flex-spacing">
                  <a
                    [routerLink]="['/active-ride-details']"
                    [queryParams]="{ id: ride?._id || ride?.id }"
                  >
                    <h6 class="title-color fw-medium">
                      {{ ride?.userId?.username || ride?.userName || 'Unknown'
                      }}
                    </h6>
                  </a>
                  <h5 class="fw-mediun success-color">
                    {{ (ride?.totalAmount != null) ? ('₹ ' + ride.totalAmount) :
                    '-' }}
                  </h5>
                </div>
                <div class="flex-align-center gap-3">
                  <!-- <div class="flex-align-center gap-1">
                    <img
                      class="star"
                      src="../../assets/images/svg/star.svg"
                      alt="star"
                    />
                    <h5 class="fw-normal title-color">
                      {{ ride?.rating || '—' }}
                    </h5>
                    <span class="content-color fw-normal"
                      >({{ ride?.ratingCount || 0 }})</span
                    >
                  </div> -->
                </div>
              </div>
            </div>

            <div class="my-ride-details">
              <div class="ride-info">
                <h6 class="fw-normal content-color">
                  {{ ride.pickUpDate | date:'dd MMM yyyy' }} at {{
                  ride.pickUpTime | date:'hh:mm a' }}
                </h6>
                <div class="flex-align-center gap-2">
                  <a href="chatting.html" class="comm-icon">
                    <img
                      class="img-fluid icon-btn"
                      src="../../assets/images/svg/messages-fill.svg"
                      alt="messages"
                    />
                  </a>
                  <a
                    [href]="'tel:' + (ride?.userId?.phoneNumber || ride?.phone || '')"
                    class="comm-icon"
                  >
                    <img
                      class="img-fluid icon-btn"
                      src="../../assets/images/svg/call-fill.svg"
                      alt="call"
                    />
                  </a>
                </div>
              </div>
              <ul class="ride-location-listing mt-3">
                <li
                  *ngFor="let location of ride?.locations; let i = index"
                  class="border-0 shadow-none"
                >
                  <div class="location-box">
                    <img
                      class="icon"
                      [src]="i === 0 ? '../../assets/images/svg/location-fill.svg' : (i === ride.locations.length - 1 ? '../../assets/images/svg/gps.svg' : '../../assets/images/svg/location-fill.svg')"
                      [alt]="i === 0 ? 'pickup' : (i === ride.locations.length - 1 ? 'dropoff' : 'waypoint')"
                    />
                    <h5
                      class="fw-light title-color"
                      [class.border-0]="i === ride.locations.length - 1"
                    >
                      {{ location?.address || location || '-' }}
                    </h5>
                  </div>
                </li>
              </ul>
            </div>
            <!-- <a href="ride-verification.html" class="btn theme-btn w-100 mt-3"
              >Pickup Customer</a
            > -->
            <button class="btn theme-btn w-100 mt-3" (click)="completeRide(ride?._id || ride?.id)">Complete Ride</button>
            <div class="reason-part mt-3">
              <p
               data-bs-toggle="modal" data-bs-target="#cancel"
                (click)="setRideId(ride)"
                style="cursor: pointer; font-weight: bold; text-align: center"
              >
                Cancel Ride
              </p>
            </div>
          </div>
        </li>
      </ul>
    </div>
  </section>
  <!-- active ride end -->
</ion-content>
<!-- panel-space start -->
<!-- <section class="panel-space"></section> -->
<!-- panel-space end -->

<!-- cancel modal starts -->
<div
  class="modal delete-modal fade"
  id="cancel"
  data-bs-backdrop="false"
  data-bs-keyboard="false"
  tabindex="-1"
  aria-labelledby="staticBackdropLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <img
        class="img-fluid icon"
        src="../../assets/images/svg/alert.svg"
        alt="alert"
        />
        <h4>Reason to cancel the ride?</h4>
        <br>
        <form [formGroup]="cancelRideForm">
          <input type="text" formControlName="reason" class="form-control">
          
        </form>
      </div>
      <div class="modal-footer">
        <a class="btn gray-btn w-50 m-0" data-bs-dismiss="modal"
          >Close</a
        >
        <button
          (click)="cancelRide()"
          class="btn theme-btn w-50 m-0"
          data-bs-dismiss="modal"
          [disabled]="cancelRideForm.invalid"
          >Yes, Cancel
      </button>
      </div>
    </div>
  </div>
</div>
<!-- cancel modal end -->

<!-- bottom navbar start -->
<app-tabs></app-tabs>
<!-- bottom navbar end -->

<!-- sidebar starts -->
<app-side-bar></app-side-bar>
<!-- sidebar end -->
